name: Build Project
on:
    release:
        types: [created]
jobs:
    create_and_upload_release_asset:
        name: Create and Upload Release Asset for ${{ matrix.OS_NAME }}
        runs-on: ${{ matrix.OS_VERSION }}
        strategy:
            matrix:
                include:
                    - OS_VERSION: macos-latest
                      OS_NAME: MacOS
                      DATA_SEPARATOR: ":"
                    - OS_VERSION: windows-latest
                      OS_NAME: Windows
                      DATA_SEPARATOR: ";"
        permissions:
          contents: write
        env:
          EXE_FILE_NAME: MazeProdigy
          ZIP_FILE_NAME: MazeProdigy-${{ matrix.OS_NAME }}.zip
        steps:
            - name: Checkout Code
              uses: actions/checkout@v3
            - name: Setup Python 3.11
              uses: actions/setup-python@v4
              with:
                python-version: '3.11'
            - name: Install Dependencies
              run: |
                python -m pip install --upgrade pip
                pip install -r requirements.txt
                pip install pyinstaller
            - name: Create Release Asset with Pyinstaller
              run: pyinstaller maze_prodigy/__main__.py --name "${{ env.EXE_FILE_NAME }}" --windowed --onefile
                --add-data "maze_prodigy/assets/themes/*.json${{ matrix.DATA_SEPARATOR }}themes"
                --add-data "maze_prodigy/assets/images/*.png${{ matrix.DATA_SEPARATOR }}images"
            - name: Archive Release Assets
              uses: thedoctor0/zip-release@0.7.1
              with:
                filename: ${{ env.ZIP_FILE_NAME }}
                path: "dist/*"
            - name: Upload Release Asset
              uses: shogo82148/actions-upload-release-asset@v1
              with:
                upload_url: ${{ github.event.release.upload_url }}
                asset_path: ${{ env.ZIP_FILE_NAME }}
                asset_name: ${{ env.ZIP_FILE_NAME }}

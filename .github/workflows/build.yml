name: Build Project
on:
    release:
        types: [created]
jobs:
    create_and_upload_release_asset:
        name: Create and Upload Release Asset for ${{ matrix.OS_NAME }}
        runs-on: ${{ matrix.OS_VERSION }}
        strategy:
            matrix:
                include:
                    - OS_VERSION: macos-latest
                      OS_NAME: MacOS
                      ASSET_PATH: maze_prodigy/assets/themes/*.json:themes
                    - OS_VERSION: windows-latest
                      OS_NAME: Windows
                      ASSET_PATH: maze_prodigy/assets/themes/*.json;themes
        permissions:
          contents: write
        env:
          ASSET_NAME: MazeProdigy-${{ matrix.OS_NAME }}
          ASSET_NAME_WITH_EXTENSION: MazeProdigy-${{ matrix.OS_NAME }}.zip
        steps:
            - name: Checkout Code
              uses: actions/checkout@v3
            - name: Setup Python 3.11
              uses: actions/setup-python@v4
              with:
                python-version: '3.11'
            - name: Install Dependencies
              run: |
                python -m pip install --upgrade pip
                pip install -r requirements.txt
                pip install pyinstaller
            - name: Create Release Asset with Pyinstaller
              run: pyinstaller maze_prodigy/__main__.py --name "${{ env.ASSET_NAME }}" --windowed --add-data "${{ matrix.ASSET_PATH }}"
            - name: Archive Release Assets
              uses: thedoctor0/zip-release@0.7.1
              with:
                filename: ${{ env.ASSET_NAME_WITH_EXTENSION }}
                path: "."
            - name: Upload Release Asset
              uses: shogo82148/actions-upload-release-asset@v1
              with:
                upload_url: ${{ github.event.release.upload_url }}
                asset_path: ${{ env.ASSET_NAME_WITH_EXTENSION }}
                asset_name: ${{ env.ASSET_NAME_WITH_EXTENSION }}
